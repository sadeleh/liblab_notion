{% extends "base.html" %}

{% block title %}{{ brainstorm_session.title }} - Ø¬Ù„Ø³Ø© Ø§Ù„Ø¹ØµÙ Ø§Ù„Ø°Ù‡Ù†ÙŠ{% endblock %}

{% block content %}
<header class="text-center mb-8">
    <h1 class="text-2xl md:text-4xl font-bold text-cyan-950">{{ brainstorm_session.title }}</h1>
    <p class="text-lg text-gray-600 mt-2">{{ brainstorm_session.description }}</p>
    <div class="mt-3 text-sm text-gray-500">
        Ø£Ù†Ø´Ø£Ù‡Ø§ {{ brainstorm_session.created_by or 'Ù…Ø¬Ù‡ÙˆÙ„' }} ÙÙŠ {{ brainstorm_session.created_at.strftime('%Y-%m-%d') }}
    </div>
</header>

<!-- Add Idea Form -->
<div class="bg-white p-6 rounded-xl shadow-lg mb-8">
    <h3 class="text-xl font-bold text-cyan-950 mb-4">
        <span class="text-2xl ml-2">ğŸ’¡</span>Ø£Ø¶Ù ÙÙƒØ±ØªÙƒ
    </h3>
    <form method="POST" action="{{ url_for('add_idea', session_id=brainstorm_session.id) }}" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="md:col-span-2">
                <textarea name="content" 
                         placeholder="Ø´Ø§Ø±Ùƒ ÙÙƒØ±ØªÙƒ Ù‡Ù†Ø§..." 
                         required
                         rows="3"
                         class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"></textarea>
            </div>
            <div>
                <input type="text" 
                       name="author" 
                       placeholder="Ø§Ø³Ù…Ùƒ"
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent">
            </div>
            <div>
                <button type="submit" 
                        class="w-full bg-cyan-950 text-white font-bold py-3 px-4 rounded-lg hover:bg-cyan-800">
                    <span class="text-xl ml-2">â•</span>Ø¥Ø¶Ø§ÙØ© ÙÙƒØ±Ø©
                </button>
            </div>
        </div>
    </form>
</div>

<!-- Ideas Display -->
<div class="mb-6">
    <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-bold text-cyan-950">
            <span class="text-2xl ml-2">ğŸŒŸ</span>Ø§Ù„Ø£ÙÙƒØ§Ø± ({{ ideas|length }})
        </h3>
        <a href="{{ url_for('brainstorm') }}" class="text-cyan-950 hover:text-cyan-700 font-medium">
            â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¬Ù„Ø³Ø§Øª
        </a>
    </div>
</div>

{% if ideas %}
    <!-- Ideas Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for idea in ideas %}
            <div class="card bg-white p-6 rounded-xl shadow-lg border-cyan-500 idea-card" data-idea-id="{{ idea.id }}">
                <div class="flex justify-between items-start mb-3">
                    <div class="flex-1 pr-4">
                        <p class="idea-content text-gray-900 leading-relaxed">{{ idea.content }}</p>
                    </div>
                    <div class="flex flex-col items-center">
                        <button onclick="voteIdea({{ idea.id }})" 
                                class="vote-btn bg-cyan-100 hover:bg-cyan-200 text-cyan-800 rounded-full w-10 h-10 flex items-center justify-center mb-1 transition-colors">
                            ğŸ‘
                        </button>
                        <span class="votes-count text-sm font-bold text-cyan-950">{{ idea.votes }}</span>
                    </div>
                </div>
                
                <!-- Edit/Delete Actions -->
                <div class="flex justify-between items-center mb-3">
                    <div class="flex space-x-2 space-x-reverse">
                        <button onclick="editIdea({{ idea.id }})" 
                                class="edit-btn bg-yellow-100 hover:bg-yellow-200 text-yellow-800 px-3 py-1 rounded-lg text-sm font-medium transition-colors">
                            âœï¸ ØªØ¹Ø¯ÙŠÙ„
                        </button>
                        <button onclick="deleteIdea({{ idea.id }})" 
                                class="delete-btn bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded-lg text-sm font-medium transition-colors">
                            ğŸ—‘ï¸ Ø­Ø°Ù
                        </button>
                    </div>
                </div>
                
                <div class="flex justify-between items-center text-sm text-gray-500 mt-4 pt-3 border-t border-gray-200">
                    <span class="idea-author">{{ idea.author or 'Ù…Ø¬Ù‡ÙˆÙ„' }}</span>
                    <span>{{ idea.created_at.strftime('%m/%d %H:%M') }}</span>
                </div>
            </div>
        {% endfor %}
    </div>
    
    <!-- Top Ideas Summary -->
    {% if ideas|length > 3 %}
        <div class="mt-12 bg-yellow-50 border border-yellow-200 rounded-lg p-6">
            <h3 class="font-bold text-yellow-950 mb-4">ğŸ† Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ø£ÙƒØ«Ø± ØªØµÙˆÙŠØªØ§Ù‹</h3>
            <div class="space-y-3">
                {% for idea in ideas[:3] %}
                    <div class="flex items-center justify-between bg-white p-3 rounded-lg">
                        <div class="flex-1">
                            <p class="text-gray-900">{{ idea.content[:80] }}{{ '...' if idea.content|length > 80 else '' }}</p>
                            <p class="text-sm text-gray-500">Ø¨ÙˆØ§Ø³Ø·Ø© {{ idea.author or 'Ù…Ø¬Ù‡ÙˆÙ„' }}</p>
                        </div>
                        <div class="flex items-center space-x-2 space-x-reverse">
                            <span class="text-2xl">ğŸ‘</span>
                            <span class="font-bold text-yellow-950">{{ idea.votes }}</span>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}
    
{% else %}
    <div class="text-center py-12">
        <div class="text-6xl mb-4">ğŸ’¡</div>
        <h3 class="text-xl font-bold text-gray-900 mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙÙƒØ§Ø± Ø¨Ø¹Ø¯</h3>
        <p class="text-gray-600 mb-6">ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ´Ø§Ø±Ùƒ ÙÙƒØ±Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù„Ø³Ø©!</p>
    </div>
{% endif %}

<!-- Session Guidelines -->
<div class="mt-12 bg-blue-50 border border-blue-200 rounded-lg p-6">
    <h3 class="font-bold text-blue-950 mb-3">ğŸ“‹ Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-blue-800">
        <ul class="space-y-2">
            <li>â€¢ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙÙƒØ§Ø± Ù…Ø±Ø­Ø¨ Ø¨Ù‡Ø§ - Ù„Ø§ Ø§Ù†ØªÙ‚Ø§Ø¯</li>
            <li>â€¢ Ø§Ø¨Ù† Ø¹Ù„Ù‰ Ø£ÙÙƒØ§Ø± Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙˆÙ† Ø°Ù„Ùƒ Ù…Ù…ÙƒÙ†Ø§Ù‹</li>
            <li>â€¢ ØµÙˆØª Ù„Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„ØªÙŠ ØªØ¬Ø¯Ù‡Ø§ ÙˆØ§Ø¹Ø¯Ø©</li>
        </ul>
        <ul class="space-y-2">
            <li>â€¢ ÙƒÙ† Ù…Ø­Ø¯Ø¯Ø§Ù‹ ÙˆÙ‚Ø§Ø¨Ù„ Ù„Ù„ØªÙ†ÙÙŠØ° Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙˆÙ† Ø°Ù„Ùƒ Ù…Ù…ÙƒÙ†Ø§Ù‹</li>
            <li>â€¢ ÙÙƒØ±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙŠ ÙƒÙ„ Ù…Ø´Ø§Ø±ÙƒØ©</li>
            <li>â€¢ Ø§Ø·Ø±Ø­ Ø£Ø³Ø¦Ù„Ø© Ù„ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ø£ÙÙƒØ§Ø±</li>
        </ul>
    </div>
</div>

<script>
    function voteIdea(ideaId) {
        fetch(`/api/vote_idea/${ideaId}`)
            .then(response => response.json())
            .then(data => {
                // Update the vote count for this idea
                const ideaCard = document.querySelector(`[data-idea-id="${ideaId}"]`);
                const votesCount = ideaCard.querySelector('.votes-count');
                votesCount.textContent = data.votes;
                
                // Visual feedback
                const voteBtn = ideaCard.querySelector('.vote-btn');
                voteBtn.style.transform = 'scale(1.2)';
                voteBtn.style.backgroundColor = '#10b981';
                setTimeout(() => {
                    voteBtn.style.transform = 'scale(1)';
                    voteBtn.style.backgroundColor = '';
                }, 300);
            })
            .catch(error => {
                console.error('Error voting:', error);
                // Simple fallback - reload page
                location.reload();
            });
    }
    
    function editIdea(ideaId) {
        const ideaCard = document.querySelector(`[data-idea-id="${ideaId}"]`);
        const contentElement = ideaCard.querySelector('.idea-content');
        const authorElement = ideaCard.querySelector('.idea-author');
        const editBtn = ideaCard.querySelector('.edit-btn');
        
        // Get current values
        const currentContent = contentElement.textContent;
        const currentAuthor = authorElement.textContent === 'Ù…Ø¬Ù‡ÙˆÙ„' ? '' : authorElement.textContent;
        
        // Create edit form
        const editForm = document.createElement('div');
        editForm.className = 'edit-form';
        editForm.innerHTML = `
            <div class="space-y-3">
                <textarea class="edit-content w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500" 
                         rows="3" placeholder="Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙÙƒØ±Ø©...">${currentContent}</textarea>
                <input type="text" class="edit-author w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500" 
                       placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¤Ù„Ù..." value="${currentAuthor}">
                <div class="flex space-x-2 space-x-reverse">
                    <button onclick="saveEdit(${ideaId})" 
                            class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                        ğŸ’¾ Ø­ÙØ¸
                    </button>
                    <button onclick="cancelEdit(${ideaId})" 
                            class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm font-medium">
                        âŒ Ø¥Ù„ØºØ§Ø¡
                    </button>
                </div>
            </div>
        `;
        
        // Replace content with edit form
        contentElement.style.display = 'none';
        contentElement.parentNode.insertBefore(editForm, contentElement.nextSibling);
        editBtn.style.display = 'none';
        
        // Focus on textarea
        editForm.querySelector('.edit-content').focus();
    }
    
    function saveEdit(ideaId) {
        const ideaCard = document.querySelector(`[data-idea-id="${ideaId}"]`);
        const editForm = ideaCard.querySelector('.edit-form');
        const newContent = editForm.querySelector('.edit-content').value.trim();
        const newAuthor = editForm.querySelector('.edit-author').value.trim();
        
        if (!newContent) {
            alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙÙƒØ±Ø©');
            return;
        }
        
        // Show loading state
        const saveBtn = editForm.querySelector('button');
        saveBtn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
        saveBtn.disabled = true;
        
        // Create form data
        const formData = new FormData();
        formData.append('content', newContent);
        formData.append('author', newAuthor);
        
        // Send update request
        fetch(`/brainstorm/{{ brainstorm_session.id }}/edit_idea/${ideaId}`, {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (response.ok) {
                // Update the display
                const contentElement = ideaCard.querySelector('.idea-content');
                const authorElement = ideaCard.querySelector('.idea-author');
                
                contentElement.textContent = newContent;
                authorElement.textContent = newAuthor || 'Ù…Ø¬Ù‡ÙˆÙ„';
                
                // Remove edit form and show content
                editForm.remove();
                contentElement.style.display = 'block';
                ideaCard.querySelector('.edit-btn').style.display = 'inline-block';
                
                // Show success feedback
                showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            } else {
                throw new Error('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙƒØ±Ø©');
            }
        })
        .catch(error => {
            console.error('Error updating idea:', error);
            showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙƒØ±Ø©', 'error');
            saveBtn.textContent = 'ğŸ’¾ Ø­ÙØ¸';
            saveBtn.disabled = false;
        });
    }
    
    function cancelEdit(ideaId) {
        const ideaCard = document.querySelector(`[data-idea-id="${ideaId}"]`);
        const editForm = ideaCard.querySelector('.edit-form');
        const contentElement = ideaCard.querySelector('.idea-content');
        
        // Remove edit form and show original content
        editForm.remove();
        contentElement.style.display = 'block';
        ideaCard.querySelector('.edit-btn').style.display = 'inline-block';
    }
    
    function deleteIdea(ideaId) {
        if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙÙƒØ±Ø©ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.')) {
            return;
        }
        
        const ideaCard = document.querySelector(`[data-idea-id="${ideaId}"]`);
        const deleteBtn = ideaCard.querySelector('.delete-btn');
        
        // Show loading state
        deleteBtn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø°Ù...';
        deleteBtn.disabled = true;
        
        // Send delete request
        fetch(`/brainstorm/{{ brainstorm_session.id }}/delete_idea/${ideaId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Animate card removal
                ideaCard.style.transition = 'all 0.3s ease';
                ideaCard.style.transform = 'scale(0.8)';
                ideaCard.style.opacity = '0';
                
                setTimeout(() => {
                    ideaCard.remove();
                    
                    // Update ideas count
                    const ideasCountElement = document.querySelector('h3 span');
                    if (ideasCountElement) {
                        const currentCount = parseInt(ideasCountElement.textContent.match(/\d+/)[0]);
                        ideasCountElement.textContent = `Ø§Ù„Ø£ÙÙƒØ§Ø± (${currentCount - 1})`;
                    }
                    
                    // Show empty state if no ideas left
                    const remainingIdeas = document.querySelectorAll('.idea-card');
                    if (remainingIdeas.length === 0) {
                        location.reload(); // Reload to show empty state
                    }
                }, 300);
                
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            } else {
                throw new Error(data.message || 'ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„ÙÙƒØ±Ø©');
            }
        })
        .catch(error => {
            console.error('Error deleting idea:', error);
            showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„ÙÙƒØ±Ø©', 'error');
            deleteBtn.textContent = 'ğŸ—‘ï¸ Ø­Ø°Ù';
            deleteBtn.disabled = false;
        });
    }
    
    function showNotification(message, type = 'info') {
        // Create notification element
        const notification = document.createElement('div');
        notification.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg text-white font-medium ${
            type === 'success' ? 'bg-green-600' : 
            type === 'error' ? 'bg-red-600' : 
            'bg-blue-600'
        }`;
        notification.textContent = message;
        
        // Add to page
        document.body.appendChild(notification);
        
        // Animate in
        notification.style.transform = 'translateX(100%)';
        notification.style.transition = 'transform 0.3s ease';
        setTimeout(() => {
            notification.style.transform = 'translateX(0)';
        }, 10);
        
        // Remove after 3 seconds
        setTimeout(() => {
            notification.style.transform = 'translateX(100%)';
            setTimeout(() => {
                notification.remove();
            }, 300);
        }, 3000);
    }
    
    // Auto-refresh ideas every 30 seconds for real-time collaboration
    setInterval(() => {
        // In a real app, you'd fetch just the ideas data via API
        // For now, we'll just show a subtle indicator that the session is live
        const title = document.querySelector('h1');
        title.style.opacity = '0.8';
        setTimeout(() => {
            title.style.opacity = '1';
        }, 200);
    }, 30000);
</script>

<style>
    .idea-card {
        transition: all 0.3s ease;
    }
    .idea-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px -8px rgba(0, 0, 0, 0.15);
    }
    .vote-btn {
        transition: all 0.2s ease;
    }
    .vote-btn:hover {
        transform: scale(1.1);
    }
</style>
{% endblock %} 