{% extends "base.html" %}

{% block title %}Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ù…Ø±ÙƒØ² ØªØ®Ø·ÙŠØ· Ø§Ù„ÙØ±ÙŠÙ‚{% endblock %}

{% block content %}
<header class="text-center mb-8 md:mb-12">
    <h1 class="text-3xl md:text-5xl font-bold text-cyan-950">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… ØªØ®Ø·ÙŠØ· Ø§Ù„ÙØ±ÙŠÙ‚</h1>
    <p class="text-lg md:text-xl text-gray-600 mt-2">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ù…Ù‡Ø§Ù… ÙØ±ÙŠÙ‚Ùƒ ÙˆÙ…ÙˆØ§Ø±Ø¯Ùƒ ÙˆØ¬Ù„Ø³Ø§Øª Ø§Ù„Ø¹ØµÙ Ø§Ù„Ø°Ù‡Ù†ÙŠ</p>
</header>

<!-- Quick Actions -->
<div class="flex flex-wrap justify-center gap-4 mb-8">
    <a href="{{ url_for('new_task') }}" class="nav-btn bg-white text-cyan-950 hover:bg-cyan-50 font-bold py-3 px-6 rounded-lg shadow-sm">
        <span class="text-xl ml-2">â•</span>Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©
    </a>
    <a href="{{ url_for('new_resource') }}" class="nav-btn bg-white text-cyan-950 hover:bg-cyan-50 font-bold py-3 px-6 rounded-lg shadow-sm">
        <span class="text-xl ml-2">ğŸ“</span>Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯
    </a>
    <a href="{{ url_for('new_brainstorm_session') }}" class="nav-btn bg-white text-cyan-950 hover:bg-cyan-50 font-bold py-3 px-6 rounded-lg shadow-sm">
        <span class="text-xl ml-2">ğŸ§ </span>Ø¹ØµÙ Ø°Ù‡Ù†ÙŠ Ø¬Ø¯ÙŠØ¯
    </a>
    <a href="{{ url_for('new_monthly_plan') }}" class="nav-btn bg-white text-cyan-950 hover:bg-cyan-50 font-bold py-3 px-6 rounded-lg shadow-sm">
        <span class="text-xl ml-2">ğŸ“…</span>Ø®Ø·Ø© Ø´Ù‡Ø±ÙŠØ©
    </a>
    <button onclick="showQuickReminderModal()" class="nav-btn bg-white text-cyan-950 hover:bg-cyan-50 font-bold py-3 px-6 rounded-lg shadow-sm">
        <span class="text-xl ml-2">ğŸ””</span>Ù„Ø§ ØªÙ†Ø³Ù‰
    </button>
</div>

<!-- Admin Panel (Super Admin Only) -->
{% if user and user.is_superadmin %}
<div class="mb-8">
    <div class="bg-gradient-to-r from-purple-100 to-indigo-100 rounded-xl shadow-lg p-6 border-2 border-purple-300">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-2xl font-bold text-purple-900">
                <span class="ml-2">ğŸ‘‘</span>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±
            </h2>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <a href="{{ url_for('admin_workspaces') }}" class="bg-white hover:bg-purple-50 text-purple-900 font-semibold py-3 px-6 rounded-lg shadow transition-all flex items-center justify-between">
                <span><span class="text-xl ml-2">ğŸ¢</span>Ø¥Ø¯Ø§Ø±Ø© Workspaces</span>
                <span class="text-gray-400">â†’</span>
            </a>
            <a href="{{ url_for('admin_users') }}" class="bg-white hover:bg-purple-50 text-purple-900 font-semibold py-3 px-6 rounded-lg shadow transition-all flex items-center justify-between">
                <span><span class="text-xl ml-2">ğŸ‘¥</span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
                <span class="text-gray-400">â†’</span>
            </a>
        </div>
        <p class="text-sm text-purple-700 mt-4">
            <span class="ml-1">ğŸ’¡</span>Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ù†Ø´Ø§Ø¡ workspaces Ø¬Ø¯ÙŠØ¯Ø©ØŒ Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†ØŒ ÙˆØªØ¹ÙŠÙŠÙ† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
        </p>
    </div>
</div>
{% endif %}

<!-- Statistics Cards -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6 mb-8">
    <div class="card bg-white p-6 rounded-xl shadow-lg border-blue-500">
        <div class="flex items-center justify-between">
            <div>
                <h3 class="text-lg font-semibold text-gray-700">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù‡Ø§Ù…</h3>
                <p class="text-3xl font-bold text-cyan-950">{{ stats.total }}</p>
            </div>
            <span class="text-4xl">ğŸ“‹</span>
        </div>
    </div>
    
    <div class="card bg-white p-6 rounded-xl shadow-lg border-green-500">
        <div class="flex items-center justify-between">
            <div>
                <h3 class="text-lg font-semibold text-gray-700">Ù…ÙƒØªÙ…Ù„Ø©</h3>
                <p class="text-3xl font-bold text-green-600">{{ stats.completed }}</p>
            </div>
            <span class="text-4xl">âœ…</span>
        </div>
    </div>
    
    <div class="card bg-white p-6 rounded-xl shadow-lg border-blue-500">
        <div class="flex items-center justify-between">
            <div>
                <h3 class="text-lg font-semibold text-gray-700">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</h3>
                <p class="text-3xl font-bold text-blue-600">{{ stats.in_progress }}</p>
            </div>
            <span class="text-4xl">ğŸ”„</span>
        </div>
    </div>
    
    <div class="card bg-white p-6 rounded-xl shadow-lg border-yellow-500">
        <div class="flex items-center justify-between">
            <div>
                <h3 class="text-lg font-semibold text-gray-700">Ù…Ø¹Ù„Ù‚Ø©</h3>
                <p class="text-3xl font-bold text-yellow-600">{{ stats.pending }}</p>
            </div>
            <span class="text-4xl">â³</span>
        </div>
    </div>
    
    <div class="card bg-white p-6 rounded-xl shadow-lg border-purple-500">
        <div class="flex items-center justify-between">
            <div>
                <h3 class="text-lg font-semibold text-gray-700">Ø§Ù„Ø®Ø·Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h3>
                <p class="text-3xl font-bold text-purple-600">{{ stats.monthly_plans }}</p>
                {% if stats.current_month_plan %}
                <p class="text-xs text-green-600 mt-1">âœ… Ø®Ø·Ø© Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø± Ù…ÙˆØ¬ÙˆØ¯Ø©</p>
                {% else %}
                <p class="text-xs text-orange-600 mt-1">âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø·Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</p>
                {% endif %}
            </div>
            <span class="text-4xl">ğŸ“…</span>
        </div>
    </div>
    
    <div class="card bg-white p-6 rounded-xl shadow-lg border-orange-500">
        <div class="flex items-center justify-between">
            <div>
                <h3 class="text-lg font-semibold text-gray-700">Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª</h3>
                <p class="text-3xl font-bold text-orange-600">{{ stats.reminders }}</p>
                {% if stats.due_today_reminders > 0 %}
                <p class="text-xs text-red-600 mt-1">âš ï¸ {{ stats.due_today_reminders }} Ù…Ø³ØªØ­Ù‚Ø© Ø§Ù„ÙŠÙˆÙ…</p>
                {% else %}
                <p class="text-xs text-green-600 mt-1">âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ°ÙƒÙŠØ±Ø§Øª Ù…Ø³ØªØ­Ù‚Ø©</p>
                {% endif %}
            </div>
            <span class="text-4xl">ğŸ””</span>
        </div>
    </div>
</div>

<!-- Main Content Grid -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Task Statistics Chart -->
    <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg">
        <h3 class="text-xl font-bold text-center mb-4 text-cyan-950">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù…</h3>
        <div class="chart-container">
            <canvas id="tasksChart"></canvas>
        </div>
    </div>
    
    <!-- Recent Activities -->
    <div class="lg:col-span-2 space-y-6">
        <!-- Recent Tasks -->
        <div class="bg-white p-6 rounded-xl shadow-lg">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-cyan-950">
                    <span class="text-2xl ml-2">ğŸ“</span>Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
                </h3>
                <a href="{{ url_for('tasks') }}" class="text-cyan-950 hover:text-cyan-700 font-medium">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</a>
            </div>
            {% if recent_tasks %}
                <div class="space-y-3">
                    {% for task in recent_tasks %}
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg priority-{{ task.priority }}">
                            <div class="flex-1">
                                <h4 class="font-medium text-gray-900">{{ task.title }}</h4>
                                <p class="text-sm text-gray-600">{{ task.assigned_to or 'ØºÙŠØ± Ù…ÙƒÙ„Ù' }}</p>
                            </div>
                            <span class="px-2 py-1 text-xs font-medium rounded-full 
                                {{ 'bg-green-100 text-green-800' if task.status == 'completed' else
                                   'bg-blue-100 text-blue-800' if task.status == 'in_progress' else
                                   'bg-yellow-100 text-yellow-800' }}">
                                {{ 'Ù…ÙƒØªÙ…Ù„Ø©' if task.status == 'completed' else 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°' if task.status == 'in_progress' else 'Ù…Ø¹Ù„Ù‚Ø©' }}
                            </span>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-gray-500 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø¨Ø¹Ø¯. <a href="{{ url_for('new_task') }}" class="text-cyan-950 hover:underline">Ø£Ù†Ø´Ø¦ Ù…Ù‡Ù…ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰!</a></p>
            {% endif %}
        </div>
        
        <!-- Recent Resources -->
        <div class="bg-white p-6 rounded-xl shadow-lg">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-cyan-950">
                    <span class="text-2xl ml-2">ğŸ“š</span>Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
                </h3>
                <a href="{{ url_for('resources') }}" class="text-cyan-950 hover:text-cyan-700 font-medium">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</a>
            </div>
            {% if recent_resources %}
                <div class="space-y-3">
                    {% for resource in recent_resources %}
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex-1">
                                <h4 class="font-medium text-gray-900">{{ resource.title }}</h4>
                                <p class="text-sm text-gray-600">{{ resource.resource_type.title() }} â€¢ {{ resource.created_by or 'Ù…Ø¬Ù‡ÙˆÙ„' }}</p>
                            </div>
                            {% if resource.url %}
                                <a href="{{ resource.url }}" target="_blank" class="text-cyan-950 hover:text-cyan-700">
                                    <span class="text-xl">ğŸ”—</span>
                                </a>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-gray-500 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø¹Ø¯. <a href="{{ url_for('new_resource') }}" class="text-cyan-950 hover:underline">Ø£Ø¶Ù Ù…ÙˆØ±Ùƒ Ø§Ù„Ø£ÙˆÙ„!</a></p>
            {% endif %}
        </div>
        
        <!-- Active Brainstorm Sessions -->
        <div class="bg-white p-6 rounded-xl shadow-lg">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-cyan-950">
                    <span class="text-2xl ml-2">ğŸ’¡</span>Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø¹ØµÙ Ø§Ù„Ø°Ù‡Ù†ÙŠ Ø§Ù„Ù†Ø´Ø·Ø©
                </h3>
                <a href="{{ url_for('brainstorm') }}" class="text-cyan-950 hover:text-cyan-700 font-medium">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</a>
            </div>
            {% if active_sessions %}
                <div class="space-y-3">
                    {% for session in active_sessions %}
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <h4 class="font-medium text-gray-900">{{ session.title }}</h4>
                            <p class="text-sm text-gray-600 mt-1">{{ session.description[:100] }}{{ '...' if session.description|length > 100 else '' }}</p>
                            <div class="flex justify-between items-center mt-2">
                                <span class="text-xs text-gray-500">Ø¨ÙˆØ§Ø³Ø·Ø© {{ session.created_by or 'Ù…Ø¬Ù‡ÙˆÙ„' }}</span>
                                <a href="{{ url_for('brainstorm_session', session_id=session.id) }}" class="text-cyan-950 hover:text-cyan-700 text-sm font-medium">Ø§Ù†Ø¶Ù… Ù„Ù„Ø¬Ù„Ø³Ø©</a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-gray-500 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø§Øª Ù†Ø´Ø·Ø©. <a href="{{ url_for('new_brainstorm_session') }}" class="text-cyan-950 hover:underline">Ø§Ø¨Ø¯Ø£ Ø¹ØµÙ Ø°Ù‡Ù†ÙŠ!</a></p>
            {% endif %}
        </div>
    </div>
</div>

<script>
    // Task Distribution Chart
    const ctx = document.getElementById('tasksChart').getContext('2d');
    
    const data = {
        labels: ['Pending', 'In Progress', 'Completed'],
        datasets: [{
            label: 'Tasks',
            data: [{{ stats.pending }}, {{ stats.in_progress }}, {{ stats.completed }}],
            backgroundColor: [
                'rgba(234, 179, 8, 0.7)',
                'rgba(59, 130, 246, 0.7)',
                'rgba(16, 185, 129, 0.7)'
            ],
            borderColor: [
                'rgba(234, 179, 8, 1)',
                'rgba(59, 130, 246, 1)',
                'rgba(16, 185, 129, 1)'
            ],
            borderWidth: 1
        }]
    };

    const options = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'top',
                labels: {
                   font: {
                       family: "'Inter', sans-serif",
                       size: 14
                   }
                }
            },
            tooltip: {
                bodyFont: {
                    family: "'Inter', sans-serif",
                },
                titleFont: {
                    family: "'Inter', sans-serif",
                }
            }
        },
        animation: {
            animateScale: true,
            animateRotate: true
        }
    };

    new Chart(ctx, {
        type: 'doughnut',
        data: data,
        options: options
    });

    // Quick Reminder Modal Functions
    function showQuickReminderModal() {
        document.getElementById('quickReminderModal').classList.remove('hidden');
        // Set default date to tomorrow
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        document.getElementById('quickReminderDate').value = tomorrow.toISOString().split('T')[0];
    }

    function hideQuickReminderModal() {
        document.getElementById('quickReminderModal').classList.add('hidden');
        document.getElementById('quickReminderForm').reset();
    }

    document.getElementById('quickReminderForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = {
            title: document.getElementById('quickReminderTitle').value,
            reminder_date: document.getElementById('quickReminderDate').value,
            priority: document.getElementById('quickReminderPriority').value,
            category: 'general',
            created_by: 'Ù…Ø¬Ù‡ÙˆÙ„'
        };
        
        fetch('/api/reminders', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                hideQuickReminderModal();
                // Show success message
                alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ°ÙƒÙŠØ± Ø¨Ù†Ø¬Ø§Ø­!');
                // Optionally reload to update stats
                location.reload();
            } else {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„');
        });
    });

    // Close modal when clicking outside
    document.getElementById('quickReminderModal').addEventListener('click', function(e) {
        if (e.target === this) {
            hideQuickReminderModal();
        }
    });
</script>

<!-- Quick Reminder Modal -->
<div id="quickReminderModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg max-w-md w-full p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4" dir="rtl">ğŸ”” ØªØ°ÙƒÙŠØ± Ø³Ø±ÙŠØ¹</h3>
        
        <form id="quickReminderForm" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1" dir="rtl">Ù„Ø§ ØªÙ†Ø³Ù‰ Ø£Ù†... *</label>
                <input type="text" 
                       id="quickReminderTitle" 
                       required 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"
                       placeholder="Ù…Ø«Ø§Ù„: ØªÙ„ØºÙŠ Ø§Ø´ØªØ±Ø§Ùƒ Ù†ØªÙÙ„ÙŠÙƒØ³"
                       dir="rtl">
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1" dir="rtl">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ°ÙƒÙŠØ±</label>
                    <input type="date" 
                           id="quickReminderDate" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1" dir="rtl">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                    <select id="quickReminderPriority" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                        <option value="low">Ù…Ù†Ø®ÙØ¶</option>
                        <option value="medium" selected>Ù…ØªÙˆØ³Ø·</option>
                        <option value="high">Ø¹Ø§Ù„ÙŠ</option>
                    </select>
                </div>
            </div>
            
            <div class="flex gap-3 pt-4">
                <button type="submit" 
                        class="flex-1 bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200">
                    â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ°ÙƒÙŠØ±
                </button>
                <button type="button" 
                        onclick="hideQuickReminderModal()" 
                        class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200">
                    Ø¥Ù„ØºØ§Ø¡
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %} 