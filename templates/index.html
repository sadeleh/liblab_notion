{% extends "base.html" %}

{% block title %}لوحة التحكم - مركز تخطيط الفريق{% endblock %}

{% block content %}
<header class="text-center mb-8 md:mb-12">
    <h1 class="text-3xl md:text-5xl font-bold text-cyan-950">لوحة تحكم تخطيط الفريق</h1>
    <p class="text-lg md:text-xl text-gray-600 mt-2">نظرة عامة على مهام فريقك ومواردك وجلسات العصف الذهني</p>
</header>

<!-- Quick Actions -->
<div class="flex flex-wrap justify-center gap-4 mb-8">
    <a href="{{ url_for('new_task') }}" class="nav-btn bg-white text-cyan-950 hover:bg-cyan-50 font-bold py-3 px-6 rounded-lg shadow-sm">
        <span class="text-xl ml-2">➕</span>إضافة مهمة
    </a>
    <a href="{{ url_for('new_resource') }}" class="nav-btn bg-white text-cyan-950 hover:bg-cyan-50 font-bold py-3 px-6 rounded-lg shadow-sm">
        <span class="text-xl ml-2">📎</span>إضافة مورد
    </a>
    <a href="{{ url_for('new_brainstorm_session') }}" class="nav-btn bg-white text-cyan-950 hover:bg-cyan-50 font-bold py-3 px-6 rounded-lg shadow-sm">
        <span class="text-xl ml-2">🧠</span>عصف ذهني جديد
    </a>
</div>

<!-- Statistics Cards -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div class="card bg-white p-6 rounded-xl shadow-lg border-blue-500">
        <div class="flex items-center justify-between">
            <div>
                <h3 class="text-lg font-semibold text-gray-700">إجمالي المهام</h3>
                <p class="text-3xl font-bold text-cyan-950">{{ stats.total }}</p>
            </div>
            <span class="text-4xl">📋</span>
        </div>
    </div>
    
    <div class="card bg-white p-6 rounded-xl shadow-lg border-green-500">
        <div class="flex items-center justify-between">
            <div>
                <h3 class="text-lg font-semibold text-gray-700">مكتملة</h3>
                <p class="text-3xl font-bold text-green-600">{{ stats.completed }}</p>
            </div>
            <span class="text-4xl">✅</span>
        </div>
    </div>
    
    <div class="card bg-white p-6 rounded-xl shadow-lg border-blue-500">
        <div class="flex items-center justify-between">
            <div>
                <h3 class="text-lg font-semibold text-gray-700">قيد التنفيذ</h3>
                <p class="text-3xl font-bold text-blue-600">{{ stats.in_progress }}</p>
            </div>
            <span class="text-4xl">🔄</span>
        </div>
    </div>
    
    <div class="card bg-white p-6 rounded-xl shadow-lg border-yellow-500">
        <div class="flex items-center justify-between">
            <div>
                <h3 class="text-lg font-semibold text-gray-700">معلقة</h3>
                <p class="text-3xl font-bold text-yellow-600">{{ stats.pending }}</p>
            </div>
            <span class="text-4xl">⏳</span>
        </div>
    </div>
</div>

<!-- Main Content Grid -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Task Statistics Chart -->
    <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg">
        <h3 class="text-xl font-bold text-center mb-4 text-cyan-950">توزيع المهام</h3>
        <div class="chart-container">
            <canvas id="tasksChart"></canvas>
        </div>
    </div>
    
    <!-- Recent Activities -->
    <div class="lg:col-span-2 space-y-6">
        <!-- Recent Tasks -->
        <div class="bg-white p-6 rounded-xl shadow-lg">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-cyan-950">
                    <span class="text-2xl ml-2">📝</span>المهام الحديثة
                </h3>
                <a href="{{ url_for('tasks') }}" class="text-cyan-950 hover:text-cyan-700 font-medium">عرض الكل</a>
            </div>
            {% if recent_tasks %}
                <div class="space-y-3">
                    {% for task in recent_tasks %}
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg priority-{{ task.priority }}">
                            <div class="flex-1">
                                <h4 class="font-medium text-gray-900">{{ task.title }}</h4>
                                <p class="text-sm text-gray-600">{{ task.assigned_to or 'غير مكلف' }}</p>
                            </div>
                            <span class="px-2 py-1 text-xs font-medium rounded-full 
                                {{ 'bg-green-100 text-green-800' if task.status == 'completed' else
                                   'bg-blue-100 text-blue-800' if task.status == 'in_progress' else
                                   'bg-yellow-100 text-yellow-800' }}">
                                {{ 'مكتملة' if task.status == 'completed' else 'قيد التنفيذ' if task.status == 'in_progress' else 'معلقة' }}
                            </span>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-gray-500 text-center py-4">لا توجد مهام بعد. <a href="{{ url_for('new_task') }}" class="text-cyan-950 hover:underline">أنشئ مهمتك الأولى!</a></p>
            {% endif %}
        </div>
        
        <!-- Recent Resources -->
        <div class="bg-white p-6 rounded-xl shadow-lg">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-cyan-950">
                    <span class="text-2xl ml-2">📚</span>الموارد الحديثة
                </h3>
                <a href="{{ url_for('resources') }}" class="text-cyan-950 hover:text-cyan-700 font-medium">عرض الكل</a>
            </div>
            {% if recent_resources %}
                <div class="space-y-3">
                    {% for resource in recent_resources %}
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex-1">
                                <h4 class="font-medium text-gray-900">{{ resource.title }}</h4>
                                <p class="text-sm text-gray-600">{{ resource.resource_type.title() }} • {{ resource.created_by or 'مجهول' }}</p>
                            </div>
                            {% if resource.url %}
                                <a href="{{ resource.url }}" target="_blank" class="text-cyan-950 hover:text-cyan-700">
                                    <span class="text-xl">🔗</span>
                                </a>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-gray-500 text-center py-4">لا توجد موارد بعد. <a href="{{ url_for('new_resource') }}" class="text-cyan-950 hover:underline">أضف مورك الأول!</a></p>
            {% endif %}
        </div>
        
        <!-- Active Brainstorm Sessions -->
        <div class="bg-white p-6 rounded-xl shadow-lg">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-cyan-950">
                    <span class="text-2xl ml-2">💡</span>جلسات العصف الذهني النشطة
                </h3>
                <a href="{{ url_for('brainstorm') }}" class="text-cyan-950 hover:text-cyan-700 font-medium">عرض الكل</a>
            </div>
            {% if active_sessions %}
                <div class="space-y-3">
                    {% for session in active_sessions %}
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <h4 class="font-medium text-gray-900">{{ session.title }}</h4>
                            <p class="text-sm text-gray-600 mt-1">{{ session.description[:100] }}{{ '...' if session.description|length > 100 else '' }}</p>
                            <div class="flex justify-between items-center mt-2">
                                <span class="text-xs text-gray-500">بواسطة {{ session.created_by or 'مجهول' }}</span>
                                <a href="{{ url_for('brainstorm_session', session_id=session.id) }}" class="text-cyan-950 hover:text-cyan-700 text-sm font-medium">انضم للجلسة</a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-gray-500 text-center py-4">لا توجد جلسات نشطة. <a href="{{ url_for('new_brainstorm_session') }}" class="text-cyan-950 hover:underline">ابدأ عصف ذهني!</a></p>
            {% endif %}
        </div>
    </div>
</div>

<script>
    // Task Distribution Chart
    const ctx = document.getElementById('tasksChart').getContext('2d');
    
    const data = {
        labels: ['Pending', 'In Progress', 'Completed'],
        datasets: [{
            label: 'Tasks',
            data: [{{ stats.pending }}, {{ stats.in_progress }}, {{ stats.completed }}],
            backgroundColor: [
                'rgba(234, 179, 8, 0.7)',
                'rgba(59, 130, 246, 0.7)',
                'rgba(16, 185, 129, 0.7)'
            ],
            borderColor: [
                'rgba(234, 179, 8, 1)',
                'rgba(59, 130, 246, 1)',
                'rgba(16, 185, 129, 1)'
            ],
            borderWidth: 1
        }]
    };

    const options = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'top',
                labels: {
                   font: {
                       family: "'Inter', sans-serif",
                       size: 14
                   }
                }
            },
            tooltip: {
                bodyFont: {
                    family: "'Inter', sans-serif",
                },
                titleFont: {
                    family: "'Inter', sans-serif",
                }
            }
        },
        animation: {
            animateScale: true,
            animateRotate: true
        }
    };

    new Chart(ctx, {
        type: 'doughnut',
        data: data,
        options: options
    });
</script>
{% endblock %} 